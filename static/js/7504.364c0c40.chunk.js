"use strict";(self.webpackChunktardedivertida=self.webpackChunktardedivertida||[]).push([[7504],{37274:function(e,a,n){n.d(a,{v:function(){return u}});var t=n(18489),r=n(83738),o=n(71046),s=n(82339),i=n(20670),c=n(76591),l=n(80184),d=["tags","gameCode"];function u(e){var a=e.tags,n=e.gameCode,u=(0,r.Z)(e,d),m=(0,i.Z)().language,p=function(e){var a=[];return e.forEach((function(e){var n;void 0!==(null===c.Up||void 0===c.Up||null===(n=c.Up[e])||void 0===n?void 0:n.index)?a[c.Up[e].index]=e:a.length<18?a[18]=e:a.push(e)})),a.filter((function(e){return Boolean(e)}))}(a);return(0,l.jsx)(o.Z,(0,t.Z)((0,t.Z)({wrap:!0},u),{},{children:p.map((function(e){var a,t;return(0,l.jsx)(s.Z,{color:null===(a=c.Up[e])||void 0===a?void 0:a.color,children:null===(t=c.Up[e])||void 0===t?void 0:t.label[m]},"".concat(n,"-").concat(e))}))}))}},67504:function(e,a,n){n.d(a,{y:function(){return W}});var t=n(36473),r=n(16726),o=n(7085),s=n(71046),i=n(77128),c=n(20670),l=n(76591),d=n(81238),u=n(12090),m=n(33032),p=n(36222),g=n(18489),v=n(50678),f=n(84322),h=n.n(f),j=n(28182),x=n(72791),Z=n(16871),N=n(42404),b=n(763),y=n(46988),_=n(56090),w=n(87309),C=n(58288),k=n(2964),S=n(8457),I=n(25922),R=n(53673),A=n(3224),B=n(50410),F=n(16728),O=n(91933),E=n(1918);var T=n(82741),P=n(40931),D=n(79119),z=n(80184),M=function(e,a){var n=Date.now(),t=n-864e5,r=Object.entries(null!==e&&void 0!==e?e:{}).reduce((function(e,a){var n=(0,v.Z)(a,2),r=n[0],o=n[1];return o>t&&(e[r]=o),e}),{});return(0,p.Z)({},l.$l,(0,g.Z)((0,g.Z)({},r),{},(0,p.Z)({},a,n)))};function G(e){var a=e.gameInfo,n=(0,Z.s0)(),t=(0,Z.TH)().pathname,r=(0,N.Z)(),d=(0,v.Z)(r,2),u=d[0],f=d[1],j=(0,c.Z)(),S=j.language,I=j.translate,G=(0,B.r)().setLoader,J=(0,F._)(),Q=(0,v.Z)(J,2),L=Q[0],W=Q[1],q=(0,x.useState)(!1),$=(0,v.Z)(q,2),K=$[0],H=$[1],V=(0,x.useState)(!1),Y=(0,v.Z)(V,2),X=Y[0],ee=Y[1],ae=(0,x.useState)(null),ne=(0,v.Z)(ae,2),te=ne[0],re=ne[1],oe=(0,A.j1)("userId"),se=(0,v.Z)(oe,2)[1],ie=(0,A.j1)("username"),ce=(0,v.Z)(ie,2)[1],le=(0,A.j1)("userAvatarId"),de=(0,v.Z)(le,2)[1],ue=(0,x.useState)({}),me=(0,v.Z)(ue,2),pe=me[0],ge=me[1],ve=function(e){var a=Object.entries(e).map((function(e){var a=(0,v.Z)(e,2);return{gameId:a[0],createdAt:a[1]}}));if(a.length<2)return null;var n=(0,b.orderBy)(a,"createdAt","desc"),t=Date.now();return n[1].createdAt-t>72e5?null:n[1].gameId}(L(l.$l)),fe=function(){var e,a,n=(0,E.O)().currentUser,t=(0,x.useState)(!1),r=(0,v.Z)(t,2),o=r[0],s=r[1],i=(0,x.useState)(""),c=(0,v.Z)(i,2),d=c[0],u=c[1],p=(0,x.useState)({gameId:"",gameName:""}),f=(0,v.Z)(p,2),j=f[0],Z=f[1],N=(0,O.useQuery)({queryKey:["meta",d],queryFn:function(){var e=(0,m.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.count("Fetching game meta..."),e.next=3,R.D0.loadGame({gameId:d});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),enabled:Boolean(d),onError:function(e){console.error(e),_.Z.error({message:"Failed to load previous game to trigger the redirect",description:JSON.stringify(e.message)})}}),b=(0,O.useMutation)({mutationKey:["oldState",j.gameId],mutationFn:function(){var e=(0,m.Z)(h().mark((function e(a){var t,r,o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=null===(t=N.data)||void 0===t?void 0:t.data,e.next=3,R.c2.performAdminAction({gameId:d,gameName:null!==(r=null===o||void 0===o?void 0:o.gameName)&&void 0!==r?r:"",playerId:n.id,action:l.ND.FORCE_STATE_PROPERTY,state:a});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),onSuccess:function(){var e=(0,m.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.Z.success({message:"Redirect successfully triggered"});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),onError:function(e){console.error(e),_.Z.error({message:"Failed to load previous game to continue the redirect",description:JSON.stringify(e.message)})}});(0,x.useEffect)((function(){var e,a;!o&&d&&j.gameId&&j.gameName&&N.isSuccess&&null!==N&&void 0!==N&&null!==(e=N.data)&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.gameName&&(s(!0),b.mutate({redirect:(0,g.Z)({redirectAt:Date.now()},j)}))}),[d,o,j,null===N||void 0===N||null===(e=N.data)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.gameName,N.isSuccess,b]);var y=function(){var e=(0,m.Z)(h().mark((function e(a,n,t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=3;break}return _.Z.error({message:"Redirect has failed to trigger"}),e.abrupt("return");case 3:Z({gameId:n,gameName:t}),u(a);case 5:case"end":return e.stop()}}),e)})));return function(a,n,t){return e.apply(this,arguments)}}();return{isSettingRedirect:N.isLoading&&b.isLoading,startRedirect:y,wasRedirectSuccessful:b.isSuccess}}(),he=fe.startRedirect,je=fe.isSettingRedirect,xe=fe.wasRedirectSuccessful;(0,x.useEffect)((function(){u.value&&te&&y.ZP.info("Copied to clipboard: ".concat(u.value))}),[u,te]);var Ze=(0,x.useCallback)((function(){H(!1)}),[]),Ne=function(){var e=(0,m.Z)(h().mark((function e(){var n,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,G("create",!0),ee(!0),e.next=5,R.c2.createGame({gameName:a.gameName,language:S,options:pe});case 5:(n=e.sent).data.gameId&&(re(n.data.gameId),se(null),ce(""),de(""),W(M(L(l.$l),n.data.gameId)),r=window.location.href.split(t)[0],f("".concat(r,"/").concat(n.data.gameId))),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),_.Z.error({message:I("Aplicativo encontrou um erro ao tentar criar o jogo","The application found an error while trying to create a game",S),description:JSON.stringify(e.t0.message),placement:"bottomLeft"}),console.error(e.t0),H(!1);case 14:return e.prev=14,ee(!1),G("create",!1),e.finish(14);case 18:case"end":return e.stop()}}),e,null,[[0,9,14,18]])})));return function(){return e.apply(this,arguments)}}(),be=function(){var e=(0,m.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:te?n("/".concat(te)):y.ZP.info(I("P\xe9ra! O jogo ainda n\xe3o foi inicializado.","Wait! The game has not been created"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(w.ZP,{type:"primary",onClick:function(){return H(!0)},block:!0,children:(0,z.jsx)(T.vN,{pt:"Criar",en:"Create"})}),K&&(0,z.jsx)(C.Z,{title:"".concat(I("Criando novo jogo","Creating new game"),": ").concat(a.title[S]),open:K,onCancel:Ze,onOk:be,okButtonProps:{disabled:Boolean(!te)||je},maskClosable:!1,children:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(o.Z,{alt:a.title[S],src:"".concat(l.fQ.BANNERS).concat(a.gameName,"-").concat(S,".jpg"),fallback:"".concat(l.fQ.BANNERS,"/em-breve-").concat(S,".jpg"),className:"round-corners"}),(0,z.jsx)(U,{options:a.options,disabled:X||Boolean(te),onChangeOptions:function(e,a){ge((function(n){return(0,g.Z)((0,g.Z)({},n),{},(0,p.Z)({},e,a))}))},selectedOptions:pe}),(0,z.jsx)(i.Z,{}),X&&(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(P.vr,{children:(0,z.jsx)(T.vN,{pt:"O jogo est\xe1 sendo criado...",en:"The game session is being created"})}),(0,z.jsx)(D.gb,{message:I("Gerando...","Generating..."),margin:!0})]}),a.version.startsWith("alpha")&&(0,z.jsx)(k.Z,{type:"warning",showIcon:!0,message:(0,z.jsx)(T.vN,{pt:"Este jogo est\xe1 em alpha, n\xe3o o jogue",en:"This game is still in alpha and shouldn't be played"})}),a.version.startsWith("beta")&&(0,z.jsx)(k.Z,{type:"warning",showIcon:!0,message:(0,z.jsx)(T.vN,{pt:"Este jogo est\xe1 em beta, prossiga com cuidado",en:"This game is in beta and bugs might be everywhere"})}),Boolean(te)?(0,z.jsxs)("div",{children:[(0,z.jsxs)(P.Dx,{className:"center",children:[(0,z.jsx)(T.vN,{pt:"Jogo inicializado",en:"Game Initialized"}),": ",te]}),(0,z.jsxs)(P.vr,{children:[ve&&!xe&&(0,z.jsx)(k.Z,{type:"info",showIcon:!0,message:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(T.vN,{pt:(0,z.jsxs)(z.Fragment,{children:["Voc\xea quer redirecionar jogadores em ",ve," para essa nova partida?"]}),en:(0,z.jsxs)(z.Fragment,{children:["Redirect players in ",ve," to this new play?"]})}),(0,z.jsx)(w.ZP,{size:"large",onClick:function(){return he(null!==ve&&void 0!==ve?ve:"",null!==te&&void 0!==te?te:"",a.gameName)},disabled:!te||!ve,loading:je,children:(0,z.jsx)(T.vN,{pt:"Redirecione-os",en:"Redirect them"})})]})}),xe&&(0,z.jsx)(k.Z,{type:"info",showIcon:!0,message:(0,z.jsx)(T.vN,{pt:(0,z.jsxs)(z.Fragment,{children:["Jogadores em ",ve," foram convidados para o jogo ",te]}),en:(0,z.jsxs)(z.Fragment,{children:["Players in ",ve," have been invited to ",te]})})})]})]}):(0,z.jsx)(s.Z,{className:"space-container",align:"center",children:(0,z.jsx)(w.ZP,{type:"primary",size:"large",disabled:X,onClick:Ne,children:(0,z.jsx)(T.vN,{pt:"Criar Jogo",en:"Create Game"})})})]})})]})}function U(e){var a=e.options,n=void 0===a?[]:a,t=e.disabled,r=e.onChangeOptions,o=e.selectedOptions;return Boolean(n.length)?(0,z.jsxs)("div",{className:"create-game-modal-options",children:[(0,z.jsx)(S.Z.Title,{level:5,className:"create-game-modal-options__title",children:(0,z.jsx)(T.vN,{pt:"Op\xe7\xf5es:",en:"Options:"})}),(null!==n&&void 0!==n?n:[]).map((function(e){var a,n;return(0,z.jsxs)(S.Z.Paragraph,{className:(0,j.Z)("create-game-modal-options__option",e.disabled&&"create-game-modal-options__option--disabled"),children:[(0,z.jsx)("span",{className:"create-game-modal-options__label",children:e.label}),(0,z.jsx)("span",{className:(0,j.Z)("create-game-modal-options__off",!o[e.key]&&"create-game-modal-options--selected"),children:null!==(a=null===e||void 0===e?void 0:e.off)&&void 0!==a?a:""}),(0,z.jsx)(I.Z,{disabled:t||e.disabled,onChange:function(a){return r(e.key,a)}}),(0,z.jsx)("span",{className:(0,j.Z)("create-game-modal-options__on",o[e.key]&&"create-game-modal-options--selected"),children:null!==(n=null===e||void 0===e?void 0:e.on)&&void 0!==n?n:""}),Boolean(e.description)&&(0,z.jsx)("span",{className:"create-game-modal-options__option-description",children:e.description})]},"option-".concat(e.label))}))]}):(0,z.jsx)("div",{className:"create-game-modal-options create-game-modal-options__no-options",children:(0,z.jsx)(S.Z.Text,{children:(0,z.jsx)(T.vN,{pt:"Este jogo n\xe3o possui customiza\xe7\xf5es",en:"This game does not support customizations"})})})}var J=n(37274),Q=n(26814),L=function(e){if(e.includes("dev"))return"#6cb3f6";if(e.includes("alpha"))return"#F97659";if(e.includes("beta"))return"#F9D859";var a=Number(e.split(".")[0]);return isNaN(a)?"#96A0A3":0===a?"#F9D859":1===a?"#72D984":2===a||a>=3?"#7CBD51":"#96A0A3"};function W(e){var a,n,m=e.game,p=e.isAdmin,g=void 0===p||p,v=(0,c.Z)(),f=v.language,h=v.translate,j=(0,d.yG)(m);return(0,z.jsxs)(t.Z,{className:"game-card",cover:(0,z.jsx)(r.Z.Ribbon,{text:m.version,color:L(m.version),children:(0,z.jsx)(o.Z,{alt:m.title[f],src:"".concat(l.fQ.BANNERS).concat(m.gameName,"-").concat(f,".jpg"),fallback:"".concat(l.fQ.BANNERS,"/em-breve-").concat(f,".jpg")})}),children:[(0,z.jsx)("div",{className:"game-card__contents",children:(0,z.jsxs)(s.Z,{direction:"vertical",children:[(0,z.jsx)(t.Z.Meta,{title:(0,z.jsxs)("span",{className:"game-card__title",title:m.title[f],children:[d.WC&&"[".concat(m.gameCode,"]")," ",m.title[f]]}),description:"".concat(h("Baseado em","Based on")," ").concat(m.basedOn.split("").reverse().join(""))}),(0,z.jsx)(t.Z.Meta,{className:"game-card__description",description:m.summary[f]}),Boolean((null===(a=m.rules)||void 0===a||null===(n=a[f])||void 0===n?void 0:n.length)>1)&&(0,z.jsx)(u.RS,{gameInfo:m,buttonProps:{size:"small",className:"game-card__margin-bottom"}}),(0,z.jsx)(J.v,{wrap:!0,size:[1,6],style:{display:"flex"},gameCode:m.gameCode,tags:m.tags})]})}),(0,z.jsxs)("div",{className:"game-card__actions",children:[m.duration&&(0,z.jsx)(t.Z.Meta,{description:(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(Q.Z,{})," ",j.min," min - ",j.max," min (Avg: ",j.ideal," min)"]})}),(0,z.jsx)(i.Z,{className:"game-card__divider"}),(0,z.jsxs)(s.Z,{direction:"vertical",children:[(0,z.jsx)(t.Z.Meta,{description:h("Para ".concat(m.playerCount.min,"-").concat(m.playerCount.max," jogadores"),"For ".concat(m.playerCount.min,"-").concat(m.playerCount.max," players"))}),(0,z.jsx)(t.Z.Meta,{className:"game-card__player-count",description:h("Melhor com ".concat(m.playerCount.best||"?"," jogadores"),"Best wih ".concat(m.playerCount.best||"?"," players"))}),(0,z.jsx)(t.Z.Meta,{className:"game-card__player-count game-card__margin-bottom",description:h("Recomendado jogar com ".concat((0,d.T0)(m.playerCount.recommended)),"Recommended with ".concat((0,d.T0)(m.playerCount.recommended)))})]}),g&&(0,z.jsx)("div",{style:{marginTop:"1rem"},children:Boolean(m.available[f])&&(0,z.jsx)(G,{gameInfo:m})})]})]},m.gameName)}}}]);
//# sourceMappingURL=7504.364c0c40.chunk.js.map