{"version":3,"file":"static/js/page-users.09a7f044.chunk.js","mappings":"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","sources":["pages/Me/Users.tsx"],"sourcesContent":["// Components\n// Sass\nimport './Me.scss';\n\nimport { App, Button, Input, Select, Space, Typography } from 'antd';\nimport { collection, getDocs, query, where } from 'firebase/firestore';\nimport { cloneDeep, merge } from 'lodash';\nimport { useMemo, useState } from 'react';\nimport { useMutation, useQuery, useQueryClient } from 'react-query';\nimport { useTitle } from 'react-use';\nimport { USER_API, USER_API_ACTIONS } from 'services/adapters';\nimport { firestore } from 'services/firebase';\n\ninterface GameUserEntry {\n  gameName?: GameName;\n  gameId: GameId;\n  startedAt: number;\n  endedAt: number;\n  playerCount: number;\n  placement: number;\n  win?: boolean;\n  last?: boolean;\n  achievements: AchievementKey[];\n}\n\ntype AvatarId = string;\ntype AchievementKey = string;\ntype GameName = string;\ntype DailyEntry = {\n  id: string; // Format YYYY-MM-DD\n  number: number;\n  victory: boolean;\n  hearts: number;\n  letters: string[];\n};\n\n/**\n * User database structure saved in Firestore\n */\ninterface FirebaseUserDB {\n  id: string;\n  isAdmin?: boolean;\n  isGuest?: boolean;\n  preferredLanguage: Language;\n  names: string[]; // unique list but most recent comes last\n  gender?: string;\n  avatars: Record<AvatarId, number>;\n  ratings: Record<GameName, number>;\n  games: Record<GameName, Record<GameId, GameUserEntry>>;\n  blurredImages: Record<ImageCardId, true>;\n  daily: Record<CardId, DailyEntry>;\n}\n\nconst DEFAULT_FIREBASE_USER_DB: FirebaseUserDB = {\n  id: '',\n  names: [],\n  avatars: {},\n  preferredLanguage: 'en',\n  games: {},\n  gender: 'unknown',\n  ratings: {},\n  blurredImages: {},\n  daily: {},\n};\n\nfunction Users() {\n  useTitle('Users - Tarde Divertida');\n  const { message, notification } = App.useApp();\n  const queryClient = useQueryClient();\n\n  const [selectedUserO, setSelectedUserO] = useState(DEFAULT_FIREBASE_USER_DB);\n  const [selectedUserD, setSelectedUserD] = useState(DEFAULT_FIREBASE_USER_DB);\n\n  const usersQuery = useQuery({\n    queryKey: ['users'],\n    queryFn: async () => {\n      const querySnapshot = await getDocs(\n        query(collection(firestore, 'users'), where('isGuest', '!=', true))\n      );\n      const result: any[] = [];\n      querySnapshot.forEach((doc) => result.push(doc.data()));\n      return result;\n    },\n  });\n\n  const usersMutation = useMutation({\n    mutationKey: ['users'],\n    mutationFn: async (data: FirebaseUserDB) => {\n      USER_API.run({ action: USER_API_ACTIONS.UPDATE_USER_DB, ...data });\n    },\n    onSuccess: () => {\n      message.success('User updated');\n      queryClient.invalidateQueries(['users']);\n    },\n    onError: (error: any) => {\n      notification.error({\n        message: 'Error',\n        description: error.message,\n      });\n    },\n  });\n\n  const data: FirebaseUserDB[] = usersQuery.data ?? [];\n\n  const onSelectUserO = (uid: string) => {\n    setSelectedUserO(data.find((e) => e.id === uid) ?? DEFAULT_FIREBASE_USER_DB);\n  };\n\n  const onSelectUserD = (uid: string) => {\n    setSelectedUserD(data.find((e) => e.id === uid) ?? DEFAULT_FIREBASE_USER_DB);\n  };\n\n  const options = data.map((entry) => (\n    <Select.Option key={entry.id} value={entry.id}>\n      <strong>{entry?.names?.[0]}</strong>: {entry.id}\n    </Select.Option>\n  ));\n\n  const selectO = (\n    <Select onChange={onSelectUserO} style={{ minWidth: 300 }}>\n      {options}\n    </Select>\n  );\n\n  const selectD = (\n    <Select onChange={onSelectUserD} style={{ minWidth: 300 }}>\n      {options}\n    </Select>\n  );\n\n  const mergedUser = useMemo(\n    () => merge(cloneDeep(selectedUserO ?? {}), cloneDeep(selectedUserD ?? {})),\n    [selectedUserO, selectedUserD]\n  );\n\n  console.log(data);\n\n  return (\n    <div>\n      <Typography.Title>Users</Typography.Title>\n      {usersQuery.isLoading && <Typography.Paragraph>Loading...</Typography.Paragraph>}\n      <Space className=\"margin\" style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)' }}>\n        <Space direction=\"vertical\">\n          <Typography.Title level={2}>Origin</Typography.Title>\n          <Space className=\"margin\">{selectO}</Space>\n          <Typography.Paragraph>\n            {selectedUserO?.names?.join(', ') ?? 'No user selected'}\n          </Typography.Paragraph>\n          <Input.TextArea\n            value={JSON.stringify(selectedUserO ?? {}, null, 2)}\n            rows={20}\n            cols={50}\n            className=\"margin\"\n          />\n        </Space>\n\n        <Space direction=\"vertical\">\n          <Typography.Title level={2}>Destination</Typography.Title>\n          <Space className=\"margin\">{selectD}</Space>\n          <Typography.Paragraph>\n            {selectedUserD?.names?.join(', ') ?? 'No user selected'}\n          </Typography.Paragraph>\n          <Input.TextArea\n            value={JSON.stringify(selectedUserD ?? {}, null, 2)}\n            rows={20}\n            cols={50}\n            className=\"margin\"\n          />\n        </Space>\n      </Space>\n\n      <Space direction=\"vertical\">\n        <Typography.Title level={2}>Merge</Typography.Title>\n\n        <Typography.Paragraph>{mergedUser?.names?.join(', ') ?? 'No user selected'}</Typography.Paragraph>\n        <Input.TextArea\n          value={JSON.stringify(mergedUser ?? {}, null, 2)}\n          rows={20}\n          cols={50}\n          className=\"margin\"\n        />\n        <Button\n          type=\"primary\"\n          size=\"large\"\n          loading={usersMutation.isLoading}\n          onClick={() => usersMutation.mutate(mergedUser)}\n          disabled={!mergedUser?.id}\n        >\n          Merge Users \"{selectedUserO.id}\" into \"{selectedUserD.id}\"\n        </Button>\n      </Space>\n    </div>\n  );\n}\n\nexport default Users;\n"],"names":["DEFAULT_FIREBASE_USER_DB","id","names","avatars","preferredLanguage","games","gender","ratings","blurredImages","daily","useTitle","App","message","notification","queryClient","useQueryClient","useState","selectedUserO","setSelectedUserO","selectedUserD","setSelectedUserD","usersQuery","useQuery","queryKey","queryFn","getDocs","query","collection","firestore","where","querySnapshot","result","forEach","doc","push","data","usersMutation","useMutation","mutationKey","mutationFn","USER_API","action","USER_API_ACTIONS","onSuccess","success","invalidateQueries","onError","error","description","options","map","entry","value","selectO","onChange","uid","find","e","style","minWidth","selectD","mergedUser","useMemo","merge","cloneDeep","console","log","isLoading","className","display","gridTemplateColumns","direction","level","join","JSON","stringify","rows","cols","type","size","loading","onClick","mutate","disabled"],"sourceRoot":""}