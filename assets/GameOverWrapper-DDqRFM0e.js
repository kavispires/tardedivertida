import{j as e,r as m,ar as b,f as N,as as v,H as E,c as O,at as T,T as s,Q as P,B as h,bv as R,am as B,g9 as M,ap as W,h as k,a$ as H,y as f,aZ as L}from"./index-p96lrkfF.js";import{H as F,g as q,u as z,P as Y,e as D}from"./Session-DVNaFa6N.js";import{T as $}from"./TheEndIcon-IDZVkw0N.js";import{S as U,P as V,a as J}from"./StepSwitcher-CyU_yS-g.js";import{u as w}from"./speech-q2vTwPOb.js";import{P as Q}from"./PlayerAvatar-CIJnURmg.js";import{G as Z}from"./RulesModal-CQYpDgvC.js";import{I as K}from"./useDevFeatures-C35RkXoI.js";import{u as X}from"./Game-DN2HMWSw.js";import{F as ee}from"./FixedMenuButton-BBKPztnE.js";import{R as ae}from"./StarFilled-DPtVyqAK.js";import{R as se,a as ne}from"./index-D_Lraz-Y.js";import{P as _}from"./progress-DWxY8Jq5.js";function oe({onClick:a,children:n,...o}){return e.jsx(F,{children:e.jsx(q,{onClick:a,...o,children:n})})}const{TextArea:te}=P;function re({customText:a}){const[n,o]=m.useState(!1);return n?null:e.jsx(ee,{content:e.jsx(ie,{customText:a,hideWidget:n,setHideWidget:o}),type:"popover",icon:e.jsx(ae,{}),position:3,open:!0})}function ie({customText:a,hideWidget:n,setHideWidget:o}){const{meta:{gameId:d}}=X(),{isLoading:i}=b(),{translate:t}=N(),[u]=v("userId"),{isAdmin:l}=E(),[g]=v("isAdminEnabled"),[r,p]=m.useState(0),[c,y]=m.useState(""),[j,C]=m.useState(!1),{start:A}=w({duration:3,onExpire:()=>o(!0),autoStart:!1}),I=z({actionName:"rating",successMessage:t("Obrigado por avaliar o jogo","Thanks for rating the game"),errorMessage:t("Envio de avaliação falhou","Rating submission has failed"),onBeforeCall:()=>C(!0),onAfterCall:A}),S=()=>{I({action:B.RATE_GAME,ratings:{comments:c,gameId:d,playerId:u,ratedAt:Date.now(),rating:r}})};return l&&!g?null:e.jsx("div",{className:O("rate-game-widget",j&&"rate-game-widget--thank-you",R(n?"bounceOut":"bounceIn")),children:j?e.jsx(T,{title:t("Obrigado","Thank you"),type:"success",showIcon:!0}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:e.jsx(s,{pt:"O que achou do jogo?",en:"Rate this game"})}),e.jsx(se,{onChange:p}),e.jsx("p",{children:e.jsx(s,{pt:"Comentários",en:"Comments",custom:a})}),e.jsx(te,{onChange:G=>y(G.target.value),disabled:i}),e.jsx(h,{type:"primary",disabled:!r||i,onClick:S,size:"small",children:e.jsx(s,{pt:"Enviar",en:"Send"})}),e.jsx("p",{style:{marginTop:"1rem"},children:e.jsx(h,{ghost:!0,onClick:()=>o(!0),size:"small",children:e.jsx(s,{pt:"Hide",en:"Hide"})})})]})})}const le="/tardedivertida/assets/game-over-title-C-lDOW8G.svg",x=()=>e.jsx(s,{pt:"Jogo concluído",en:"The game is over"});function ce({state:a,children:n,className:o,rateWidgetCustomText:d,announcement:i}){const t=M(),{language:u}=N(),[l,g]=m.useState(!1),r=W();w({duration:15,onExpire:()=>g(!0)});const p=!!a.winners&&a.winners.length>0||!!a.group||!!a.team;return e.jsxs(U,{className:o,announcement:i,fullWidth:!0,children:[e.jsx("div",{className:"game-over__banner",children:e.jsx(Z,{gameName:t.gameName,width:400,title:t.title,stripWidth:window.innerWidth+64,showLogo:l,className:"game-over__strip",children:!l&&e.jsx(k.img,{src:le,alt:"Game Over",className:"game-over__title",style:{width:400,transform:"translate(-50%, -50%)"},initial:{opacity:0,scale:.5,transform:"translate(-50%, -50%)"},animate:{opacity:1,scale:1,transform:"translate(-50%, -50%)"},transition:{delay:4,duration:2},exit:{opacity:0,scale:0,transform:"translate(-50%, -50%)"}})})}),p&&a?.group?.outcome!=="NON_WINNABLE_GAME"&&e.jsxs(K,{contained:!0,children:[!!a.winners&&a.winners.length>0&&e.jsxs("div",{className:"game-over__winner-container",children:[e.jsxs("div",{className:"game-over__text",children:[e.jsx(x,{})," ",a.winners.length>1?e.jsx(s,{pt:"e os vencedores são",en:"and the winners are"}):e.jsx(s,{pt:"e o vencedor é",en:"and the winner is"}),":"]}),e.jsx("ul",{className:"game-over__winners",children:a.winners.map(c=>e.jsxs("li",{className:"game-over__winner",children:[e.jsx(Q,{className:"game-over__avatar",avatarId:c.avatarId??25}),e.jsxs("div",{className:"game-over__winner-name",children:[e.jsx("strong",{children:c.name??"?"}),","," ",H[c.avatarId].description[u]]})]},`winner-${c.name}`))})]}),!!a.group&&e.jsxs("div",{className:"game-over__winner",children:[e.jsx("div",{className:"game-over__text",children:e.jsx(x,{})}),e.jsx(_,{type:"circle",strokeColor:a.group.outcome==="WIN"?{"0%":"#4ba226","100%":"#87d068"}:{"0%":"#ff0000","70%":"#ff0000","100%":"#87d068"},percent:Math.round((a.group.score??0)*100/(a.group.goal??1))}),e.jsx("div",{className:"game-over__text",children:a.group.outcome==="WIN"?e.jsx(s,{pt:"Parabéns, vocês ganharam!",en:"Congratulations, you won!"}):e.jsx(s,{pt:"Não foi dessa vez, que vergonha heim!",en:"You lost! What a shame!"})})]}),!!a.team&&e.jsxs("div",{className:"game-over__winner",children:[e.jsx("div",{className:"game-over__text",children:e.jsx(x,{})}),e.jsx(_,{type:"circle",strokeColor:{"0%":"#ff0000","70%":"#ff0000","100%":"#87d068"},percent:a.team.score??0}),e.jsx("div",{className:"game-over__text",children:a.team.victory?e.jsx(s,{pt:"Parabéns, vocês ganharam!",en:"Congratulations, you won!"}):e.jsx(s,{pt:"Não foi dessa vez, que vergonha heim!",en:"You lost! What a shame!"})})]}),!a.winners&&!a.team&&!a.group&&e.jsx("div",{className:"game-over__text",children:e.jsx(x,{})})]}),e.jsx(re,{customText:d}),n,e.jsxs(f,{align:"center",orientation:"vertical",className:"full-width padding",style:{marginTop:"48px"},children:[e.jsxs(f.Compact,{children:[e.jsx(h,{onClick:()=>r("/"),children:e.jsx(s,{pt:"Página Inicial",en:"Home Page"})}),e.jsx(h,{children:e.jsxs(L,{to:"/me",target:"_blank",children:[e.jsx(s,{pt:"Meu Perfil",en:"My Profile"})," ",e.jsx(ne,{style:{rotate:"-45deg"}})]})})]}),e.jsx(oe,{onClick:()=>r("/hub"),children:"Hub"})]})]})}function ye({state:a,players:n,announcementIcon:o=e.jsx($,{}),announcementTitle:d,announcementDuration:i=3,announcementContent:t,children:u=e.jsx(e.Fragment,{}),rateWidgetCustomText:l}){const[g]=m.useState(0),r=e.jsx(V,{icon:o,title:e.jsx(s,{pt:"E o jogo chegou ao fim...",en:"And the game is over...",custom:d}),currentRound:a?.round?.current,duration:i,type:"overlay",children:!!t&&t});return e.jsx(Y,{phase:a?.phase,allowedPhase:D.DEFAULT.GAME_OVER,className:"game-over__container",children:e.jsx(J,{step:g,players:n,children:e.jsx(ce,{state:a,rateWidgetCustomText:l,announcement:r,children:u})})})}export{ye as G};
