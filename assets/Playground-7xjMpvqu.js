import{r as D,j as s,h as F,E as K,x as Q,L as X,v as W}from"./index-9n8xigqu.js";import{D as Y}from"./DevHeader-DC84Syaj.js";import{u as Z,a as _,D as tt,b as et,T as ot,M as nt,c as rt,d as st,C as it}from"./core.esm-D9A8spCo.js";import{u as at}from"./useTDImageCardUrl-CFCj7Lq6.js";import"./index-B18vL2-r.js";import"./extends-CF3RwP-h.js";import"./useId-NP1LU8oX.js";import"./useTDBaseUrl-BF9foKiS.js";const n=3,B=(r,l,d)=>{const v={width:"100%",height:"100%",backgroundColor:"#2d2d2d",backgroundRepeat:"no-repeat",position:"absolute",top:0,left:0};if(!l)return v;const b=r%n,y=Math.floor(r/n),j=d>1?y*(100/(d-1)):0;return{...v,backgroundImage:`url(${l})`,backgroundSize:`${n*100}% ${d*100}%`,backgroundPosition:`${b*(100/(n-1))}% ${j}%`}},S=(r,l,d)=>d?l===r+1&&Math.floor(r/n)===Math.floor(l/n):l===r+n,ct=({index:r})=>{const{setNodeRef:l,isOver:d}=rt({id:`slot-${r}`,data:{index:r}});return s.jsx("div",{ref:l,style:{position:"relative",width:"100%",height:"100%",zIndex:0},children:s.jsx("div",{style:{position:"absolute",inset:0,border:"1px solid rgba(255,255,255,0.05)",backgroundColor:d?"rgba(255,255,255,0.1)":"transparent"}})})},lt=({pieceId:r,currentSlotIndex:l,totalRows:d,imageUrl:v,isHidden:b,disabled:y,isJustDropped:j,borders:w={top:!0,right:!0,bottom:!0,left:!0}})=>{const{attributes:O,listeners:R,setNodeRef:f,transform:$,isDragging:G}=st({id:`piece-${r}`,data:{piece:{id:r},originIndex:l},disabled:y}),E=l%n,H=Math.floor(l/n),g=`${E*(100/n)}%`,T=`${H*(100/d)}%`,z=`${100/n}%`,V=`${100/d}%`,C="0.5px solid rgba(0,0,0,0.5)",N=j?{duration:0}:{type:"spring",stiffness:350,damping:25};return s.jsxs(F.div,{ref:f,initial:!1,animate:{top:T,left:g},transition:N,style:{position:"absolute",width:z,height:V,transform:it.Translate.toString($),zIndex:G?50:10,opacity:b?0:1,touchAction:"none",cursor:y?"default":"grab"},...R,...O,children:[s.jsx("div",{style:B(r,v,d)}),s.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",borderTop:w.top?C:"none",borderRight:w.right?C:"none",borderBottom:w.bottom?C:"none",borderLeft:w.left?C:"none"}})]})},dt=({data:r,onSaveProgress:l,width:d})=>{const v=at(r.cardId),b=r.pieces?r.pieces.length:0,y=Math.max(1,Math.ceil(b/n)),j=d>0?d:300,w=j*1.5,O=j/n,R=w/y,[f,$]=D.useState([]),[G,E]=D.useState([]),H=D.useMemo(()=>r.pieces?Array.from({length:r.pieces.length},(e,t)=>t):[],[r.pieces]),[g,T]=D.useState(null);D.useEffect(()=>{if(r.pieces&&r.pieces.length>0){const e=r.pieces.map(t=>({id:t}));$(e)}},[r.pieces]),D.useEffect(()=>{if(f.length===0)return;const e=f.map(t=>t?t.id:-1);l?.(e)},[f,l]);const z=D.useMemo(()=>f.length===0?!1:f.every((e,t)=>e&&e.id===t),[f]),V=(e,t)=>{if(!e[t])return[];const a=new Set,p=[t];for(a.add(t);p.length>0;){const o=p.shift(),u=e[o],k=[{idx:o-1,dir:"horizontal"},{idx:o+1,dir:"horizontal"},{idx:o-n,dir:"vertical"},{idx:o+n,dir:"vertical"}];for(const{idx:h,dir:c}of k){if(h<0||h>=b)continue;if(c==="horizontal"){const x=Math.floor(o/n),M=Math.floor(h/n);if(x!==M)continue}if(a.has(h))continue;const m=e[h];if(m){let x=!1;c==="horizontal"?h>o?x=S(u.id,m.id,!0):x=S(m.id,u.id,!0):h>o?x=S(u.id,m.id,!1):x=S(m.id,u.id,!1),x&&(a.add(h),p.push(h))}}}return Array.from(a).sort((o,u)=>o-u)},C=(e,t)=>{const i=t[e];if(!i)return{top:!0,right:!0,bottom:!0,left:!0};const a=(M,L)=>{if(M<0||M>=b)return!1;const P=t[M];return P?L==="horizontal"?S(i.id,P.id,!0)||S(P.id,i.id,!0):S(i.id,P.id,!1)||S(P.id,i.id,!1):!1},p=e-n,o=e+n,u=e-1,k=e+1,h=p>=0&&a(p,"vertical"),c=o<b&&a(o,"vertical"),m=e%n!==0&&a(u,"horizontal"),x=e%n!==2&&a(k,"horizontal");return{top:!h,right:!x,bottom:!c,left:!m}},N=Z(_(nt,{activationConstraint:{distance:5}}),_(ot,{activationConstraint:{delay:100,tolerance:5}})),J=e=>{if(z)return;const{active:t}=e,{piece:i,originIndex:a}=t.data.current,o=V(f,a).map(u=>u-a);T({pieceId:i.id,originIndex:a,groupIndices:o}),E([])},q=e=>{const{over:t}=e,i=g;if(T(null),!t||!i||z)return;const a=t.data.current?.index,p=i.originIndex;if(a===p)return;const o=i.groupIndices.map(c=>p+c),u=i.groupIndices.map(c=>a+c);if(!u.every(c=>c>=0&&c<b))return;const h=o.map(c=>f[c]?.id).filter(c=>c!==void 0);E(h),$(c=>{const m=[...c],x=new Set(o),M=new Set(u),L=u.filter(I=>!x.has(I)).map(I=>c[I]);return o.filter(I=>!M.has(I)).forEach((I,A)=>{A<L.length&&(m[I]=L[A])}),u.forEach((I,A)=>{const U=o[A];m[I]=c[U]}),m}),setTimeout(()=>{E([])},250)};return s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:j,margin:"0 auto",userSelect:"none"},children:[s.jsx("div",{style:{position:"relative",width:j,height:w,backgroundColor:"#1f1f1f",boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.5)",border:z?"2px solid #4ade80":"none",transition:"border 0.3s ease"},children:s.jsxs(tt,{sensors:N,onDragStart:J,onDragEnd:q,children:[s.jsx("div",{style:{display:"grid",width:"100%",height:"100%",gridTemplateColumns:`repeat(${n}, 1fr)`,gridTemplateRows:`repeat(${y}, 1fr)`,position:"absolute",inset:0,pointerEvents:"none"},children:Array.from({length:b}).map((e,t)=>s.jsx(ct,{index:t},t))}),s.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"auto"},children:H.map(e=>{const t=f.findIndex(o=>o?.id===e);if(t===-1)return null;let i=!1;if(g){const o=t-g.originIndex;g.groupIndices.includes(o)&&(i=!0)}const a=C(t,f),p=G.includes(e);return s.jsx(lt,{pieceId:e,currentSlotIndex:t,totalRows:y,imageUrl:v,isHidden:i,disabled:z,borders:a,isJustDropped:p},e)})}),s.jsx(et,{dropAnimation:null,children:g?s.jsx("div",{style:{position:"relative",width:O,height:R},children:g.groupIndices.map(e=>{const t=g.originIndex+e,i=f[t];if(!i)return null;const a=t%n-g.originIndex%n,p=Math.floor(t/n)-Math.floor(g.originIndex/n),o=C(t,f);return s.jsxs("div",{style:{position:"absolute",width:"100%",height:"100%",left:`${a*100}%`,top:`${p*100}%`,zIndex:999,filter:"drop-shadow(0px 5px 10px rgba(0,0,0,0.5))"},children:[s.jsx("div",{style:B(i.id,v,y)}),s.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",borderTop:o.top?"0.5px solid rgba(255,255,255,0.8)":"none",borderRight:o.right?"0.5px solid rgba(255,255,255,0.8)":"none",borderBottom:o.bottom?"0.5px solid rgba(255,255,255,0.8)":"none",borderLeft:o.left?"0.5px solid rgba(255,255,255,0.8)":"none"}})]},i.id)})}):null})]})}),z&&s.jsx("div",{style:{marginTop:"1rem",color:"#4ade80",fontWeight:"bold"},children:"Puzzle Completed!"})]})};function vt(){K("Playground | Dev | Tarde Divertida");const[r,l]=D.useState([]);return s.jsxs(Q,{children:[s.jsx(Y,{title:"Playground"}),s.jsxs(X.Content,{className:"dev-content",children:[s.jsx("div",{children:"playground content"}),s.jsx(dt,{data:{id:"example",number:1,type:"vitrais",title:"Example Puzzle",cardId:"td-d10-92",pieces:W.shuffle(Array.from({length:W.sample([12,15,18,21,24,28,30])},(d,v)=>v))},width:275})]})]})}export{vt as default};
